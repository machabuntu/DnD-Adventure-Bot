# Техническое описание проекта D&D Telegram Bot

## Структура проекта

### Основные модули:
- **bot.py**: Основной файл Telegram бота с командами и обработчиками
- **database.py**: Менеджер базы данных и схема таблиц
- **character_generation.py**: Полная система создания персонажей D&D 5e
- **adventure_manager.py**: Управление приключениями и группами игроков
- **grok_api.py**: Интеграция с Grok API для генерации контента
- **combat_manager.py**: Система боя с инициативой и механиками D&D
- **action_handler.py**: Обработка действий игроков и взаимодействие с ИИ
- **callback_handler.py**: Центральный обработчик всех inline кнопок

### Конфигурация и данные:
- **config.py**: Токены, креденшалы БД и настройки
- **create_database.py**: Инициализация схемы базы данных
- **pdf_parser.py**: Парсинг D&D данных из PDF документации
- **requirements.txt**: Python зависимости
- **Docs/**: PDF файлы с данными D&D (расы, классы, оружие, заклинания)

### Документация:
- **README.md**: Руководство пользователя
- **TECHNICAL.md**: Техническая документация архитектуры

## Основные компоненты

### Telegram Bot
- Использует библиотеку `python-telegram-bot` для реализации команд.
- Основные команды включают создание персонажа, управление приключениями, оставление и присоединение к приключениям.
- Работает только в разрешенном чате, чтобы избежать вмешательства.

### Database Management
- Реализовано через `mysql-connector-python` для взаимодействия с MariaDB.
- Таблицы покрывают аспекты игры, такие как персонажи, приключения, оружие и заклинания.
- Инициализация таблиц происходит через `create_database.py`.

### Grok API
- Отправляет и получает структурированные сообщения от Grok API для ведения повествования.
- Использует структурные подсказки и триггеры, например, `***COMBAT_START***`, чтобы обрабатывать события сражений.

### PDF Parsing
- Извлекает данные из предоставленных PDF-документов и заполняет таблицы в базе данных.
- Использует `PyPDF2` для получения текстового содержимого PDF.

## Работа с Grok
- **Лучшие практики**: сохранять контекст и структуру сообщений в запросах и ответах.
- **Структурированные данные**: соответствуют заранее определенным форматам, например, данные о врагах.

## Начало работы
1. Запустите `create_database.py` для создания необходимой базы данных и таблиц.
2. Запустите `pdf_parser.py` для заполнения данных из PDF в базу данных.
3. Запустите `bot.py` и взаимодействуйте с ботом через Telegram, используя указанные команды.

## Будущие шаги
- Автоматизация запуска с использованием контейнеров Docker.
- Расширение функциональности для поддержки более сложных механик D&D (например, динамические события, более сложные сценарии).
