# Система импорта заклинаний D&D

## Описание

Система импорта заклинаний позволяет загружать заклинания всех уровней (1-9) из JSON файлов в базу данных бота. Система автоматически обрабатывает параметры скалирования заклинаний при использовании слотов более высокого уровня.

## Структура файлов

### Расположение файлов
- `Docs/1.txt` - заклинания 1-го уровня  
- `Docs/2.txt` - заклинания 2-го уровня
- `Docs/3.txt` - заклинания 3-го уровня
- И так далее до `Docs/9.txt`

### Формат JSON

Каждый файл должен содержать массив объектов заклинаний со следующей структурой:

```json
[
  {
    "level": 1,
    "name": "Название заклинания",
    "base_damage": "2d10",
    "damage_type": "Огонь",
    "short_description": "Краткое описание заклинания",
    "deals_damage": true,
    "area_effect": false,
    "classes": ["Колдун", "Волшебник"],
    "saving_throw": "Ловкость",
    "scaling": "Урон увеличивается на 1d10 за каждый уровень ячейки выше 1-го."
  }
]
```

### Поля заклинания

- `level` (число) - уровень заклинания (1-9)
- `name` (строка) - название заклинания на русском языке
- `base_damage` (строка/null) - базовый урон (например, "2d10", "1d4 + 1")
- `damage_type` (строка/null) - тип урона (Огонь, Холод, Некротический и т.д.)
- `short_description` (строка) - краткое описание эффекта заклинания
- `deals_damage` (булево) - наносит ли заклинание урон
- `area_effect` (булево) - воздействует ли на площадь
- `classes` (массив строк) - список классов, которые могут использовать заклинание
- `saving_throw` (строка/null) - характеристика спасброска (Сила, Ловкость, Телосложение, Интеллект, Мудрость, Харизма)
- `scaling` (строка/null) - описание правил скалирования при использовании слотов высокого уровня

## Типы скалирования

Система автоматически определяет тип скалирования на основе текста в поле `scaling`:

### 1. `slot_damage` - Увеличение урона
Применяется когда в описании есть "урон увеличивается"
- Пример: "Урон увеличивается на 1d6 за каждый уровень ячейки выше 1-го"

### 2. `slot_targets` - Дополнительные цели
Применяется когда в описании есть "дополнительное существо" или "дополнительная цель"
- Пример: "Вы можете нацелить заклинание на одно дополнительное существо за каждый уровень ячейки выше 1-го"

### 3. `slot_projectiles` - Дополнительные снаряды
Применяется для заклинаний типа "Волшебная стрела"
- Пример: "Заклинание создает по одному дополнительному дротику за каждый уровень ячейки выше 1-го"

### 4. `slot_healing` - Увеличение лечения
Применяется когда в описании есть "лечение"
- Пример: "Лечение увеличивается на 2d4 за каждый уровень ячейки выше 1-го"

### 5. `slot_temp_hp` - Временные хиты
Применяется когда в описании есть "временные хиты"
- Пример: "Временные хиты увеличиваются на 5 за каждый уровень ячейки выше 1-го"

### 6. `slot_duration` - Увеличение длительности
Применяется когда в описании есть "концентрация" или "длительность"
- Пример: "При использовании ячейки 3-го уровня можно поддерживать концентрацию до 8 часов"

### 7. `slot_area` - Увеличение области
Применяется когда в описании есть "радиус", "куб", "сфера"
- Пример: "Радиус сферы увеличивается на 20 футов за каждый уровень ячейки выше 1-го"

### 8. `slot_special` - Особые правила
Применяется для заклинаний с уникальными правилами скалирования

## Использование

### Импорт заклинаний

1. Подготовьте файлы с заклинаниями в формате JSON (1.txt, 2.txt и т.д.)
2. Запустите скрипт импорта:
```bash
python import_spells_from_json.py
```

Скрипт автоматически:
- Удалит старые placeholder заклинания на английском языке
- Импортирует все заклинания из доступных файлов
- Создаст правила скалирования для каждого заклинания
- Заполнит таблицы spell_slot_scaling и spell_scaling_rules

### Проверка результатов

Используйте скрипт проверки:
```bash
python check_imported_spells.py
```

## Таблицы базы данных

### spells
Основная таблица заклинаний:
- `id` - идентификатор
- `level` - уровень заклинания (0 для заговоров, 1-9 для заклинаний)
- `name` - название
- `damage` - базовый урон
- `damage_type` - тип урона
- `description` - описание
- `is_combat` - боевое заклинание
- `is_area_of_effect` - воздействует на площадь
- `available_classes` - JSON с классами
- `saving_throw` - характеристика спасброска
- `scaling_type` - тип скалирования
- `base_scaling_info` - JSON с базовой информацией о скалировании

### spell_slot_scaling
Правила скалирования через слоты:
- `spell_id` - ID заклинания
- `slot_level` - уровень слота (2-9)
- `damage_bonus` - бонус к урону
- `duration_bonus` - бонус к длительности
- `target_bonus` - дополнительные цели
- `other_effects` - JSON с другими эффектами

### spell_scaling_rules
Специальные правила скалирования:
- `spell_id` - ID заклинания
- `rule_type` - тип правила
- `rule_value` - значение правила
- `rule_description` - описание правила

## Примеры заклинаний

### Заклинание с увеличением урона
```json
{
  "name": "Адское возмездие",
  "base_damage": "2d10",
  "damage_type": "Огонь",
  "scaling": "Урон увеличивается на 1d10 за каждый уровень ячейки выше 1-го."
}
```

### Заклинание с дополнительными целями
```json
{
  "name": "Благословение",
  "scaling": "Вы можете нацелить заклинание на одно дополнительное существо за каждый уровень ячейки выше 1-го."
}
```

### Заклинание со специальным скалированием
```json
{
  "name": "Волшебная стрела",
  "base_damage": "1d4 + 1",
  "scaling": "Заклинание создает по одному дополнительному дротику за каждый уровень ячейки выше 1-го."
}
```

## Логирование

Все операции импорта логируются в файл `import_spells.log` с подробной информацией о:
- Количестве импортированных заклинаний
- Созданных правилах скалирования
- Возможных ошибках

## Примечания

1. Скрипт автоматически удаляет старые заклинания того же уровня перед импортом новых
2. Все тексты должны быть на русском языке
3. Формат костей урона: используйте "d" вместо "к" (скрипт автоматически преобразует)
4. Для заклинаний без скалирования оставьте поле `scaling` равным `null`
