# Система импорта заклинаний с постоянными ID

## Описание проблемы
Ранее использовались два отдельных скрипта (`import_cantrips_from_json.py` и `import_spells_from_json.py`), которые при повторном запуске удаляли все заклинания и создавали их заново с новыми ID. Это приводило к проблемам с JOIN-запросами во время активных приключений.

## Решение
Создан объединенный скрипт `import_all_spells.py`, который:
1. Полностью очищает все таблицы с заклинаниями
2. **Сбрасывает AUTO_INCREMENT до 1** для всех таблиц
3. Импортирует заклинания в строгом порядке (сначала заговоры, затем уровни 1-9)
4. Гарантирует постоянные ID при условии добавления новых заклинаний только в конец файлов

## Использование

### Полный импорт всех заклинаний
```bash
python import_all_spells.py
```

### Структура файлов с заклинаниями
- `Docs/заговоры.txt` - заговоры (уровень 0)
- `Docs/1.txt` - заклинания 1 уровня
- `Docs/2.txt` - заклинания 2 уровня
- ...
- `Docs/9.txt` - заклинания 9 уровня

## Важные правила для сохранения постоянных ID

⚠️ **КРИТИЧЕСКИ ВАЖНО:**
1. **Никогда не добавляйте новые заклинания в середину файлов!**
2. **Новые заклинания добавляйте только в конец соответствующего файла**
3. **Не удаляйте существующие заклинания из середины файлов**
4. **Не меняйте порядок существующих заклинаний**

### Правильный способ добавления новых заклинаний:
```json
// Docs/1.txt - заклинания 1 уровня
[
  { "name": "Существующее заклинание 1", ... },
  { "name": "Существующее заклинание 2", ... },
  { "name": "Существующее заклинание 3", ... },
  // Новые заклинания добавляйте ТОЛЬКО СЮДА, в конец массива:
  { "name": "НОВОЕ заклинание", ... }
]
```

## Затрагиваемые таблицы

Скрипт очищает и пересоздает данные в следующих таблицах:
- `spells` - основная таблица заклинаний
- `cantrip_scaling` - скалирование заговоров по уровню персонажа
- `spell_slot_scaling` - скалирование заклинаний через слоты
- `spell_scaling_rules` - специальные правила скалирования

## Проверка постоянства ID

После импорта скрипт выводит первые 10 заклинаний с их ID:
```
ID   1: [Заговор] Брызги кислоты
ID   2: [Заговор] Волшебная рука
ID   3: [Заговор] Дружба
...
```

При повторных запусках эти ID должны оставаться неизменными.

## Резервное копирование

⚠️ **Рекомендуется создавать резервную копию базы данных перед запуском импорта во время активного приключения!**

```bash
# Пример создания дампа таблиц с заклинаниями
mysqldump -u user -p database_name spells cantrip_scaling spell_slot_scaling spell_scaling_rules > spells_backup.sql
```

## Логирование

Скрипт создает подробный лог в файле `import_all_spells.log` с информацией о:
- Количестве удаленных записей
- Количестве импортированных заклинаний
- Количестве добавленных правил скалирования
- Любых ошибках при импорте

## Старые скрипты

Старые скрипты `import_cantrips_from_json.py` и `import_spells_from_json.py` оставлены для истории, но **НЕ ДОЛЖНЫ использоваться**. Используйте только `import_all_spells.py`.
