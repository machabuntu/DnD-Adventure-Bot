# Обновление: Расширенная информация о персонажах и проверка навыков/заклинаний

## Что было добавлено:

### 1. Расширенная информация о персонажах при генерации приключения

**Изменённые файлы:**
- `database.py` - добавлена таблица `character_skills`
- `character_generation.py` - сохранение навыков персонажа в базу данных
- `adventure_manager.py` - загрузка полной информации о персонажах
- `grok_api.py` - отправка детальной информации о персонажах в Grok API

**Что изменилось:**
- При генерации вступления к приключению Grok API теперь получает:
  - Полные характеристики персонажей (сила, ловкость, etc.) с модификаторами
  - Все навыки персонажа
  - Все известные заклинания с разбивкой по уровням
- Это позволяет ИИ лучше адаптировать приключение под возможности группы

### 2. Проверка навыков и заклинаний в команде /action

**Изменённые файлы:**
- `action_handler.py` - добавлена валидация навыков и заклинаний

**Как это работает:**
- Игроки могут использовать навыки и заклинания, заключая их в квадратные скобки: `[Убеждение]`, `[Малое исцеление]`
- Бот автоматически проверяет, владеет ли персонаж указанным навыком или заклинанием
- Если навык/заклинание недоступно, действие отклоняется с объяснением
- Если доступно, действие передается ИИ для обработки

**Примеры использования:**
```
/action Я использую [Убеждение] чтобы договориться с торговцем
/action Кастую [Малое исцеление] на раненого союзника  
/action Применяю [Обман] и [Скрытность] для тайного прохода
```

## Технические детали:

### Новая таблица базы данных:
```sql
CREATE TABLE character_skills (
    id INT AUTO_INCREMENT PRIMARY KEY,
    character_id INT,
    skill_name VARCHAR(100) NOT NULL,
    FOREIGN KEY (character_id) REFERENCES characters(id) ON DELETE CASCADE
)
```

### Регулярное выражение для поиска навыков/заклинаний:
```python
skill_spell_pattern = r'\[([^\]]+)\]'
```

## Тестирование:

Создан тестовый скрипт `test_skills_system.py` для проверки:
- Корректности регулярного выражения
- Структуры базы данных
- Логики проверки навыков и заклинаний

## Совместимость:

- Изменения обратно совместимы
- Существующие персонажи будут работать без навыков (пустой список)
- Новые персонажи автоматически получат навыки при создании
- База данных автоматически обновляется при запуске `db.init_database()`
