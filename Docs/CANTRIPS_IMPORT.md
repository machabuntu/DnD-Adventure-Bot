# Импорт заговоров из JSON файла

## Описание
Скрипт `import_cantrips_from_json.py` импортирует заговоры из файла `Docs/заговоры.txt` в базу данных, заменяя существующие placeholder заклинания на реальные заговоры с правилами скалирования.

## Что делает скрипт

1. **Удаляет старые заговоры** из базы данных (уровень 0 заклинаний)
2. **Импортирует новые заговоры** из JSON файла со следующими полями:
   - Название заговора
   - Базовый урон и тип урона
   - Описание
   - Классы, которым доступен заговор
   - Характеристика спасброска
   - Правила скалирования

3. **Создает записи скалирования** в таблице `cantrip_scaling` для каждого заговора с уроном
4. **Поддерживает разные типы скалирования**:
   - Увеличение урона (стандартное удвоение/утроение костей)
   - Увеличение количества лучей (Мистический заряд)
   - Изменение типа костей (Дубинка)
   - Увеличение дистанции (Уход за умирающим)

## Использование

```bash
python import_cantrips_from_json.py
```

## Структура JSON файла

```json
[
  {
    "Уровень": "Заговор",
    "Русское название": "Брызги кислоты",
    "Базовый урон": "1к6",
    "Тип урона": "Кислотой",
    "Краткое описание": "Создает кислотный шарик, взрывающийся сферой.",
    "Наносит ли заклинание урон": true,
    "Воздействует ли заклинание на площадь": true,
    "список классов с этим заклинанием": ["Волшебник", "Чародей", "Круг земли (Друид)"],
    "Характеристика спасброска": "Ловкости",
    "Правила скалирования при повышении уровня": "Урон увеличивается на 1к6 на 5-м (2к6), 11-м (3к6) и 17-м (4к6) уровнях."
  }
]
```

## Изменения в базе данных

### Таблица `spells`
- Поле `damage_type` увеличено до VARCHAR(100) для поддержки длинных описаний типов урона
- Добавлены поля:
  - `is_combat` - является ли заклинание боевым
  - `is_area_of_effect` - воздействует ли на площадь
  - `available_classes` - JSON список классов
  - `saving_throw` - характеристика спасброска
  - `scaling_type` - тип скалирования
  - `base_scaling_info` - JSON с информацией о скалировании

### Таблица `cantrip_scaling`
Содержит правила скалирования заговоров по уровню персонажа:
- `spell_id` - ID заговора
- `character_level` - уровень персонажа (1, 5, 11, 17)
- `damage_dice` - кости урона на этом уровне
- `num_beams` - количество лучей/снарядов
- `other_effects` - JSON с дополнительными эффектами

## Результаты импорта

После успешного выполнения:
- **34 заговора** импортировано в базу данных
- **72 записи** о скалировании создано
- Все заговоры правильно привязаны к классам
- Правила скалирования корректно применены

## Проверка результатов

```sql
-- Проверить количество заговоров
SELECT COUNT(*) FROM spells WHERE level = 0;

-- Посмотреть заговоры с их классами
SELECT name, available_classes FROM spells WHERE level = 0;

-- Проверить скалирование
SELECT s.name, cs.character_level, cs.damage_dice
FROM spells s
JOIN cantrip_scaling cs ON s.id = cs.spell_id
WHERE s.name = 'Огненный снаряд'
ORDER BY cs.character_level;
```

## Логи

Скрипт создает файл `import_cantrips.log` с подробной информацией о процессе импорта.

## Возможные ошибки и решения

1. **Data too long for column** - увеличьте размер соответствующего поля в БД
2. **Duplicate entry** - заговор уже существует, скрипт автоматически обновит его
3. **Foreign key constraint** - убедитесь, что таблицы `cantrip_scaling` и `spell_scaling_rules` существуют
